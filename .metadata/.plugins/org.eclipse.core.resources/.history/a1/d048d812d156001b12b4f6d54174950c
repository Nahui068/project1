package com.mycompany.project1;

import java.io.PrintWriter;
import java.util.List;

import javax.inject.Inject;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.mycompany.project1.bean.eq_ReservationBean;
import com.mycompany.project1.service.eq_ReservationService;

@Controller
public class Eq_reservationController {

	@Inject
	eq_ReservationService service;
	
	// 장비 예약 화면
	@RequestMapping("/eq_reservation")
	public String eq_reservation() {
		
		return "eq_reservation";
	}
	
	// 장비 예약 현황 보기
	@RequestMapping("/eq_show")
	public String selectEqReservation(String eq1, String eq2, Model model) throws Exception{
		
		
		List rlist = (List)service.selectEqReservation(eq1, eq2);
		model.addAttribute("rlist",rlist);
		model.addAttribute("eq1",eq1);
		model.addAttribute("eq2",eq2);
		
		return "eq_reservation";
		
	}
	
	// 장비 예약
	@RequestMapping("/eq_submit")
	@ResponseBody
	public void insertEqReservation(eq_ReservationBean eqReservation) throws Exception{

		service.insertEqReservation(eqReservation);
		
	}
	
	// 장비 예약 수정
	@RequestMapping("/eq_update")
	public void updateEqReservation(eq_ReservationBean eqReservation,HttpSession session,HttpServletResponse response ) throws Exception{
		String session_id = (String)session.getAttribute("id");
		String r_id = eqReservation.getId();
		
		if(session_id.equals(r_id)) {
			service.updateEqReservation(eqReservation);
		}else {
			response.setContentType("text/html;charset=utf-8");
			PrintWriter out = response.getWriter();
			out.println("<script>");
			out.println("alert('수정할 권한이 없습니다.')");
			out.println("window.location=history.back()");
			out.println("</script>");
		}
		
	}
	
	// 장비 예약 삭제
	@RequestMapping("/eq_delete")
	public void deleteEqReservation(eq_ReservationBean eqReservation) throws Exception{
		String session_id = (String) session.getAttribute("id");
		String r_id = eqReservation.getId();
		
		if(session_id.equals(r_id)) {
			service.deleteEqReservation(eqReservation);
		}else {
			
			
		}
		
	}
	
}
